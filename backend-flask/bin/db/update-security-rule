#! /bin/bash
-e # stop if it fails at any point

if [ -z "$DB_SG_ID" ] || [ -z "$DB_SG_RULE_ID" ]; then
    echo "Error: DB_SG_ID and DB_SG_RULE_ID must be set."
    exit 1
fi

aws ec2 modify-security-group-rules \
    --group-id $DB_SG_ID \
    --security-group-rules "SecurityGroupRuleId=$DB_SG_RULE_ID,SecurityGroupRule={IpProtocol=tcp,FromPort=5432,ToPort=5432,CidrIpv4=$GITPOD_IP/32}"