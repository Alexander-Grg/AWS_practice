#!/bin/bash
set -e

if [ "$1" == "prod" ]; then
    CON_STRING="${PROD_CONNECTION_STRING}"
else
    CON_STRING="${CONNECTION_STRING}"
fi

# Replace the internal hostname 'db' with 'localhost' for host access
CON_STRING="${CON_STRING/@db/@localhost}"

echo "Creating the database..."

# Connect to the 'postgres' database to create 'webapp'
psql "${CON_STRING%/*}/postgres" -c "CREATE DATABASE webapp;"