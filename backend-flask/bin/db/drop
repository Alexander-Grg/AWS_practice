#! /bin/bash

if [ "$1" == "prod" ]; then
    CON_STRING="${PROD_CONNECTION_STRING}"
    echo "Connecting to the production database..."
else
    CON_STRING="${CONNECTION_STRING}"
    echo "Connecting to the development database..."
fi

# Replace the internal hostname 'db' with 'localhost' for host access
CON_STRING="${CON_STRING/@db/@localhost}"

echo "Dropping the database..."

# Append '/postgres' to connect to the maintenance database before dropping 'webapp'
psql "${CON_STRING%/*}/postgres" -c "DROP DATABASE IF EXISTS webapp;"